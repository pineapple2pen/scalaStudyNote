### 函数式编程基础

#### 函数的定义/声明

##### 概念说明

1. 在Scala中，方法和函数几乎可以等同（比如他们的定义、使用、运行机制都一样），只是函数的使用方式更加的灵活多变
2. 函数式编程是从编程方式（范式）角度来谈的，可以这样理解：函数式编程把函数当作一等公民，充分利用函数、支持的函数的多种使用方式。在Scala中，函数是一等公民，像一个变量一样，既可以作为函数的参数使用，也可以将函数赋值给一个变量，函数的创建不依赖于类或者对象，而在Java中，函数的创建需要依赖于类、抽象类或者接口。
3. 面向对象编程是以对象为基础的编程方式。
4. 在Scala中函数式编程和对象编程融合在了以起。

```scala
object Test {
  def main(args: Array[String]): Unit = {
    // 正常使用对象类对象中的方法
    val cal = new CalWays()
    println(cal.sum(10, 15))

    // 将类方法转为函数
    val f1 = cal.sum _
    println(f1(55, 45))

    // 直接定义函数
    val f2 = (n1: Int, n2: Int) => {
      n1 + n2
    }
    println(f2(66, 34))
  }
}

class CalWays {

  def sum(n1: Int, n2: Int): Int = {
    n1 + n2
  }
}
```

```
			类方法		  
          /
		oop
		/
一段代码
		\
	  函数式编程
	      \
	      	函数
```

所以函数和方法的本质是一样的。

##### 函数的定义

```
def 函数名（参数名：参数类型, ...）: 返回值类型 = {
	语句
	返回值
}
```

1. 函数的声明关键字为 *def* (definition)
2. （参数名：参数类型， ... ）表示函数的输入（参数列表），可以为空，如有用逗号`,`隔开
3. 函数中的语句： 表示为了实现某一功能的代码块
4. 函数可以有返回值也可没有（`Unit`）
5. 返回值类型
   1. `: 返回值类型 =` 必须按照声明设定返回
   2. `=` 表示返回值类型不确定，使用类型推导完成
   3.  ` `空表示没有返回值，代码块中的return不会生效
6.  又设定返回值时，若代码块中没有`return`，会用最后一行代码的结果作为返回值

##### 函数式编程小结

1. “函数式编程”是一种“编程范式”
2. 它属于“结构化编程”的一种，只要思想是把运算过程尽量写成一系列嵌套的函数调用
3. 函数式编程中，将函数也当作数据类型，因此可以接收函数当作输入（参数）和输出（返回值）
4. 函数式编程中，最重要的就是函数

---

#### 函数的运行机制

通俗点说就是    程序员调用方法，然后方法返回结果的过程

```scala
object Test {
  def main(args: Array[String]): Unit = {
    var n1 = 1
    var n2 = 5
    print(sum(n1, n2))
  }

  def sum(n1: Int, n2: Int): Int = {
    n1 + n2
  }
}
```

![image.png](https://upload-images.jianshu.io/upload_images/6623925-b1c6f12c453c40e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

main函数运行的时候，首先会在栈内存中创建main函数的栈空间，当执行到函数时，会将指针跳转到函数栈中，执行完毕后，又返回到main栈空间。

---

#### 递归【推荐使用】

一个函数在函数体内部又调用了本身，这样称为递归调用。

```scala
object Test {
  def main(args: Array[String]): Unit = {
    dt(5)
  }
  def dt(num: Int) {
    if (num >  2) {
      dt(num - 1)
    }
    print(num)
  }
}
```

上面函数的执行结果是`2345`

###### 总结

1. 程序执行一个函数的时候，就创建一个新的受保护的独立空间（新函数栈）
2. 函数的局部变量是独立的，不会相互影响
3. 递归必须向退出递归的条件逼近，否则会无限递归
4. 当一个函数执行完毕，或者遇到return，就会返回，遵守谁调用就将结果返回给谁

###### 递归练习

使用递归输出斐波那契数列、

```scala
object Test {
  def main(args: Array[String]): Unit = {
    print(fbn(10)) // 1 1 2 3 5 8 13 21 34 55 89

  }

  def fbn(n: Int): Int = {
    if(n<=0) return 0
    if (n == 1 || n == 2) {
      1
    } else {
      fbn(n - 1) + fbn(n - 2)
    }
  }
}
```

猴子吃桃问题，猴子有n个桃子，第一天吃了一半加一个，第二天又吃了一半加一个，第三天依次类推，到第m天还剩下s个桃子，求n值？

```scala
object Test {
  def main(args: Array[String]): Unit = {
    print(peach(10, 1))
  }
    /**
    * 猴子吃桃子
    * @param day    第m天
    * @param peachs 剩余s个桃子
    * @return
    */
  def peach(day: Int, peachs: Int): Int = {
    // 10   1
    // 9    n / 2 -1 = 1  4
    // 8    n / 2 -1 = 4  10
    // ...
    var t = 0
    if (day > 1) {
      t = peach(day - 1, (peachs + 1) * 2)
    }else{
      return peachs
    }
    t
  }
}
```

---

#### 函数的注意事项和细节

1. 函数的形参列表可以是多个，如果函数没有形参，调用的时候可以不带（）
2. 形参泪飙和返回值列表的数据类型可以是值类型和引用类型
3. Scala中的函数可以根据函数体的最后一行代码自行推断函数的返回值类型，那么在这样的情况下，return关键字可以省略
4. 因为Scala可以自定推断，所以在省略return关键字的场合，返回值类型也可以省略
5. 如果函数明确使用return关键字，那么函数返回就不能自行推断了，这个时候在函数声明返回值时需要明确写成`: 返回值类型 =`，当然，如果什么都不写，那么即使函数体中有return，那么返回值也是Unit
6. 如果函数明确声明无返回值（Unit），那么函数体中即使使用了return关键字，其返回值任然是Unit
7. 如果明确函数无返回值或者不确定返回值类型，那么返回值类型可以省略（或者声明为Any）
8. Scala语法中任何的语法结构都可以嵌套在其他语法结构，即函数中可以再声明/定义函数，类中可以再声明类，方法中可以再声明/定义方法
9. Scala函数的形参，在声明参数的时，直接赋初始值（默认值），这时调用函数时，如果没有指定实参，则会使用默认值。如果指定了实参，则实参会覆盖默认值。

---

#### 惰性函数和异常